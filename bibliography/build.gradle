task bibliographyMarkdown {
    doLast {
        exec {
            workingDir '.'
            commandLine 'mkdir', "-p", "$rootDir/build"
        }
        exec {
            workingDir '.'
            commandLine 'pandoc', "-t", "gfm", "-s", "--csl", "apa-numeric-superscript-brackets.csl", "--citeproc", "-o", "$rootDir/build/bibliography.md", "bibliography.tex"
        }
    }
}

task bibliographyPdflatex {
    doLast{
        exec {
            workingDir '.'
            commandLine 'mkdir', "-p", "temp"
        }
        exec {
            workingDir '.'
            commandLine 'mkdir', "-p", "$rootDir/build"
        }
        exec {
            workingDir '.'
            commandLine 'cp', "bibliography.tex", "temp/"
        }
        exec {
            workingDir '.'
            commandLine 'cp', "bibliography.bib", "temp/"
        }
    }

    doLast {
        exec {
            workingDir 'temp'
            commandLine 'pdflatex', "bibliography.tex"
        }
        exec {
            workingDir 'temp'
            commandLine 'bibtex', "bibliography"
        }
        exec {
            workingDir 'temp'
            commandLine 'pdflatex', "bibliography.tex"
        }
        exec {
            workingDir 'temp'
            commandLine 'pdflatex', "bibliography.tex"
        }
    }

    doLast {
        exec {
            workingDir '.'
            commandLine 'mv', "temp/bibliography.pdf", "$rootDir/build/"
        }
        exec {
            workingDir '.'
            commandLine 'rm', "-r", "temp"
        }
    }
}

task build {
    dependsOn bibliographyMarkdown
    dependsOn bibliographyPdflatex
    def outputDir = file("$rootDir/build/")
    outputs.dir outputDir

    doLast {}
}
